<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Tezos.Roll_storage</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Tezos.Roll_storage</h1>

<div class="code">
</div>

<div class="doc">
Generated by coq-of-ocaml 
</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">OCaml.OCaml</span>.<br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">type_scope</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Unset</span> <span class="id" title="var">Positivity</span> <span class="id" title="var">Checking</span>.<br/>
<span class="id" title="keyword">Unset</span> <span class="id" title="var">Guard</span> <span class="id" title="var">Checking</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Tezos.Environment.html#"><span class="id" title="library">Tezos.Environment</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">Environment.Notations</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Constants_repr.html#"><span class="id" title="library">Tezos.Constants_repr</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Constants_storage.html#"><span class="id" title="library">Tezos.Constants_storage</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Contract_repr.html#"><span class="id" title="library">Tezos.Contract_repr</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Cycle_repr.html#"><span class="id" title="library">Tezos.Cycle_repr</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Level_repr.html#"><span class="id" title="library">Tezos.Level_repr</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Manager_repr.html#"><span class="id" title="library">Tezos.Manager_repr</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Misc.html#"><span class="id" title="library">Tezos.Misc</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Raw_context.html#"><span class="id" title="library">Tezos.Raw_context</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Roll_repr.html#"><span class="id" title="library">Tezos.Roll_repr</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Seed_repr.html#"><span class="id" title="library">Tezos.Seed_repr</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Seed_storage.html#"><span class="id" title="library">Tezos.Seed_storage</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Storage_mli.html#"><span class="id" title="library">Tezos.Storage_mli</span></a>. <span class="id" title="keyword">Module</span> <a name="Storage"><span class="id" title="module">Storage</span></a> := <a class="idref" href="Tezos.Storage_mli.html#"><span class="id" title="module">Storage_mli</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Storage_sigs.html#"><span class="id" title="library">Tezos.Storage_sigs</span></a>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="Tezos.Tez_repr.html#"><span class="id" title="library">Tezos.Tez_repr</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">Misc</span>.<br/>

<br/>
<span class="comment">(*&nbsp;❌&nbsp;Structure&nbsp;item&nbsp;`typext`&nbsp;not&nbsp;handled.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;type_extension&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;❌&nbsp;Top-level&nbsp;evaluations&nbsp;are&nbsp;ignored&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;top_level_evaluation&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="get_contract_delegate"><span class="id" title="definition">get_contract_delegate</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">c</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">contract</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>))) :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#contract"><span class="id" title="variable">contract</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="delegate_pubkey"><span class="id" title="definition">delegate_pubkey</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Manager"><span class="id" title="axiom">Storage.Contract.Manager</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">delegate</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Environment.html#Signature.Public_key_hash"><span class="id" title="definition">Signature.Public_key_hash</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Environment.html#S.SPublic_key_hash.t"><span class="id" title="projection">S.SPublic_key_hash.t</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Environment.html#Signature.Public_key"><span class="id" title="definition">Signature.Public_key</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Environment.html#S.SPublic_key.t"><span class="id" title="projection">S.SPublic_key.t</span></a>)) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Manager"><span class="id" title="axiom">Storage.Contract.Manager</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Contract_repr.html#implicit_contract"><span class="id" title="definition">Contract_repr.implicit_contract</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> | <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="Tezos.Manager_repr.html#Hash"><span class="id" title="constructor">Manager_repr.Hash</span></a> <span class="id" title="var">_</span>)) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.fail"><span class="id" title="axiom">Error_monad.fail</span></a> <span class="id" title="axiom">extensible_type_value</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="Tezos.Manager_repr.html#Public_key"><span class="id" title="constructor">Manager_repr.Public_key</span></a> <span class="id" title="var">pk</span>) ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <span class="id" title="var">pk</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="clear_cycle"><span class="id" title="definition">clear_cycle</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">c</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">cycle</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">index</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.delete"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Last_for_snapshot"><span class="id" title="axiom">Storage.Roll.Last_for_snapshot</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.delete"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.delete_snapshot"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.delete_snapshot</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="fold"><span class="id" title="definition">fold</span></a> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Set</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.context"><span class="id" title="projection">Storage_sigs.Single_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_repr.html#roll"><span class="id" title="definition">Roll_repr.roll</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.value</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="Tezos.Roll_storage.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">→</span></a> <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Roll_storage.html#A"><span class="id" title="variable">A</span></a>)) (<span class="id" title="var">init</span> : <a class="idref" href="Tezos.Roll_storage.html#A"><span class="id" title="variable">A</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Roll_storage.html#A"><span class="id" title="variable">A</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">last</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.get"><span class="id" title="projection">Storage_sigs.Single_data_storage.get</span></a>) <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">roll</span> : <a class="idref" href="Tezos.Roll_repr.html#roll"><span class="id" title="definition">Roll_repr.roll</span></a>) (<span class="id" title="var">acc</span> : <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Roll_storage.html#A"><span class="id" title="variable">A</span></a>)) {<span class="id" title="keyword">struct</span> <span class="id" title="var">ctxt</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Roll_storage.html#A"><span class="id" title="variable">A</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">acc</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Roll_repr.html#op_eq"><span class="id" title="definition">Roll_repr.op_eq</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#last"><span class="id" title="variable">last</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Roll_repr.html#succ"><span class="id" title="definition">Roll_repr.succ</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a>) (<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">delegate</span> ⇒ <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Roll_repr.html#succ"><span class="id" title="definition">Roll_repr.succ</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a>) (<a class="idref" href="Tezos.Roll_storage.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <span class="id" title="var">delegate</span> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_repr.html#first"><span class="id" title="definition">Roll_repr.first</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#init"><span class="id" title="variable">init</span></a>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="snapshot_rolls_for_cycle"><span class="id" title="definition">snapshot_rolls_for_cycle</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">cycle</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">index</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> (<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a> 1) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.__snapshot_value"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.__snapshot_value</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">last</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.get"><span class="id" title="projection">Storage_sigs.Single_data_storage.get</span></a>) <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Last_for_snapshot"><span class="id" title="axiom">Storage.Roll.Last_for_snapshot</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a> <a class="idref" href="Tezos.Roll_storage.html#last"><span class="id" title="variable">last</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="freeze_rolls_for_cycle"><span class="id" title="definition">freeze_rolls_for_cycle</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">cycle</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.context</span></a>)) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">max_index</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">__seed_value</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#get"><span class="id" title="axiom">Storage.Seed.For_cycle.get</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rd</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Seed_repr.html#initialize_new"><span class="id" title="definition">Seed_repr.initialize_new</span></a> <a class="idref" href="Tezos.Roll_storage.html#__seed_value"><span class="id" title="variable">__seed_value</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a> <a class="idref" href="Tezos.Environment.html#MBytes.of_string"><span class="id" title="axiom">MBytes.of_string</span></a> "roll_snapshot" <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">seq</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Seed_repr.html#__sequence_value"><span class="id" title="definition">Seed_repr.__sequence_value</span></a> <a class="idref" href="Tezos.Roll_storage.html#rd"><span class="id" title="variable">rd</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;❌&nbsp;Constant&nbsp;of&nbsp;type&nbsp;int32&nbsp;is&nbsp;converted&nbsp;to&nbsp;int&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">selected_index</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Int32.to_int"><span class="id" title="axiom">Int32.to_int</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Pervasives.fst"><span class="id" title="axiom">Pervasives.fst</span></a> (<a class="idref" href="Tezos.Seed_repr.html#take_int32"><span class="id" title="definition">Seed_repr.take_int32</span></a> <a class="idref" href="Tezos.Roll_storage.html#seq"><span class="id" title="variable">seq</span></a> (<a class="idref" href="Tezos.Environment.html#Int32.of_int"><span class="id" title="axiom">Int32.of_int</span></a> <a class="idref" href="Tezos.Roll_storage.html#max_index"><span class="id" title="variable">max_index</span></a>))) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#selected_index"><span class="id" title="variable">selected_index</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.fold_left_s"><span class="id" title="axiom">Error_monad.fold_left_s</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">ctxt</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">index</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Environment.html#Compare.Int"><span class="id" title="axiom">Compare.Int</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Environment.html#Compare.S.op_eq"><span class="id" title="projection">Compare.S.op_eq</span></a>) <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a> <a class="idref" href="Tezos.Roll_storage.html#selected_index"><span class="id" title="variable">selected_index</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.delete_snapshot"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.delete_snapshot</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Last_for_snapshot"><span class="id" title="axiom">Storage.Roll.Last_for_snapshot</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.delete"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>) <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Misc.html#op_minusminusgt"><span class="id" title="definition">Misc.op_minusminusgt</span></a> 0 (<a class="idref" href="Tezos.Environment.html#Pervasives.op_minus"><span class="id" title="axiom">Pervasives.op_minus</span></a> <a class="idref" href="Tezos.Roll_storage.html#max_index"><span class="id" title="variable">max_index</span></a> 1)) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a name="Random"><span class="id" title="module">Random</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Random.int32_to_bytes"><span class="id" title="definition">int32_to_bytes</span></a> (<span class="id" title="var">i</span> : <span class="id" title="definition">int32</span>) : <a class="idref" href="Tezos.Environment.html#MBytes.t"><span class="id" title="axiom">MBytes.t</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">__b_value</span> := <a class="idref" href="Tezos.Environment.html#MBytes.create"><span class="id" title="axiom">MBytes.create</span></a> 4 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;❌&nbsp;Sequences&nbsp;of&nbsp;instructions&nbsp;are&nbsp;ignored&nbsp;(operator&nbsp;";")&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;❌&nbsp;instruction_sequence&nbsp;";"&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#__b_value"><span class="id" title="variable">__b_value</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Random.level_random"><span class="id" title="definition">level_random</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">__seed_value</span> : <a class="idref" href="Tezos.Seed_repr.html#seed"><span class="id" title="inductive">Seed_repr.seed</span></a>) (<span class="id" title="var">use</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<span class="id" title="keyword">level</span> : <a class="idref" href="Tezos.Level_repr.html#t"><span class="id" title="definition">Level_repr.t</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Seed_repr.html#t"><span class="id" title="inductive">Seed_repr.t</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">position</span> := <a class="idref" href="Tezos.Roll_storage.html#level"><span class="id" title="variable">level</span></a>.(<a class="idref" href="Tezos.Level_repr.html#t.cycle_position"><span class="id" title="projection">Level_repr.t.cycle_position</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Seed_repr.html#initialize_new"><span class="id" title="definition">Seed_repr.initialize_new</span></a> <a class="idref" href="Tezos.Roll_storage.html#__seed_value"><span class="id" title="variable">__seed_value</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#MBytes.of_string"><span class="id" title="axiom">MBytes.of_string</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Pervasives.op_caret"><span class="id" title="axiom">Pervasives.op_caret</span></a> "level " (<a class="idref" href="Tezos.Environment.html#Pervasives.op_caret"><span class="id" title="axiom">Pervasives.op_caret</span></a> <a class="idref" href="Tezos.Roll_storage.html#use"><span class="id" title="variable">use</span></a> ":"))<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#Random.int32_to_bytes"><span class="id" title="definition">int32_to_bytes</span></a> <a class="idref" href="Tezos.Roll_storage.html#position"><span class="id" title="variable">position</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Random.owner"><span class="id" title="definition">owner</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) (<span class="id" title="var">kind</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<span class="id" title="keyword">level</span> : <a class="idref" href="Tezos.Level_repr.html#t"><span class="id" title="definition">Level_repr.t</span></a>) (<span class="id" title="var">offset</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.Snapshot"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.Snapshot</span></a>).(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">cycle</span> := <a class="idref" href="Tezos.Roll_storage.html#level"><span class="id" title="variable">level</span></a>.(<a class="idref" href="Tezos.Level_repr.html#t.cycle"><span class="id" title="projection">Level_repr.t.cycle</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">random_seed</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Seed_storage.html#for_cycle"><span class="id" title="definition">Seed_storage.for_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rd</span> := <a class="idref" href="Tezos.Roll_storage.html#Random.level_random"><span class="id" title="definition">level_random</span></a> <a class="idref" href="Tezos.Roll_storage.html#random_seed"><span class="id" title="variable">random_seed</span></a> <a class="idref" href="Tezos.Roll_storage.html#kind"><span class="id" title="variable">kind</span></a> <a class="idref" href="Tezos.Roll_storage.html#level"><span class="id" title="variable">level</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">__sequence_value</span> := <a class="idref" href="Tezos.Seed_repr.html#__sequence_value"><span class="id" title="definition">Seed_repr.__sequence_value</span></a> <a class="idref" href="Tezos.Roll_storage.html#rd"><span class="id" title="variable">rd</span></a> (<a class="idref" href="Tezos.Environment.html#Int32.of_int"><span class="id" title="axiom">Int32.of_int</span></a> <a class="idref" href="Tezos.Roll_storage.html#offset"><span class="id" title="variable">offset</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">index</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">bound</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Last_for_snapshot"><span class="id" title="axiom">Storage.Roll.Last_for_snapshot</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span> (<span class="id" title="var">__sequence_value</span> : <a class="idref" href="Tezos.Seed_repr.html#sequence"><span class="id" title="inductive">Seed_repr.sequence</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="keyword">struct</span> <span class="id" title="var">__sequence_value</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.Snapshot"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.Snapshot</span></a>).(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">roll</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">__sequence_value</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> := <a class="idref" href="Tezos.Roll_repr.html#random"><span class="id" title="definition">Roll_repr.random</span></a> <a class="idref" href="Tezos.Roll_storage.html#__sequence_value"><span class="id" title="variable">__sequence_value</span></a> <a class="idref" href="Tezos.Roll_storage.html#bound"><span class="id" title="variable">bound</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.Snapshot"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.Snapshot</span></a>).(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">((</span></a><a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">),</span></a> <span class="id" title="var">roll</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#__sequence_value"><span class="id" title="variable">__sequence_value</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">delegate</span> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <span class="id" title="var">delegate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">snapshot_exists</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.snapshot_exists"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.snapshot_exists</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#index"><span class="id" title="variable">index</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><span class="id" title="var">_</span> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Environment.html#Error_monad.fail_unless"><span class="id" title="axiom">Error_monad.fail_unless</span></a> <a class="idref" href="Tezos.Roll_storage.html#snapshot_exists"><span class="id" title="variable">snapshot_exists</span></a> <span class="id" title="axiom">extensible_type_value</span> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#__sequence_value"><span class="id" title="variable">__sequence_value</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Tezos.Roll_storage.html#Random"><span class="id" title="module">Random</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="baking_rights_owner"><span class="id" title="definition">baking_rights_owner</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) (<span class="id" title="keyword">level</span> : <a class="idref" href="Tezos.Level_repr.html#t"><span class="id" title="definition">Level_repr.t</span></a>) (<span class="id" title="var">priority</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.Snapshot"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.Snapshot</span></a>).(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>)) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#owner"><span class="id" title="definition">Random.owner</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> "baking" <a class="idref" href="Tezos.Roll_storage.html#level"><span class="id" title="variable">level</span></a> <a class="idref" href="Tezos.Roll_storage.html#priority"><span class="id" title="variable">priority</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="endorsement_rights_owner"><span class="id" title="definition">endorsement_rights_owner</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) (<span class="id" title="keyword">level</span> : <a class="idref" href="Tezos.Level_repr.html#t"><span class="id" title="definition">Level_repr.t</span></a>) (<span class="id" title="var">slot</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.Snapshot"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.Snapshot</span></a>).(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>)) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#owner"><span class="id" title="definition">Random.owner</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> "endorsement" <a class="idref" href="Tezos.Roll_storage.html#level"><span class="id" title="variable">level</span></a> <a class="idref" href="Tezos.Roll_storage.html#slot"><span class="id" title="variable">slot</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="traverse_rolls"><span class="id" title="definition">traverse_rolls</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">head</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>))) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">acc</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">roll</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="keyword">struct</span> <span class="id" title="var">acc</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>))) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> (<a class="idref" href="Tezos.Environment.html#List.rev"><span class="id" title="axiom">List.rev</span></a> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">next</span> ⇒ <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#cons"><span class="id" title="constructor">cons</span></a> <span class="id" title="var">next</span> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a>) <span class="id" title="var">next</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a> <a class="idref" href="Tezos.Roll_storage.html#head"><span class="id" title="variable">head</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="Tezos.Roll_storage.html#head"><span class="id" title="variable">head</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="get_rolls"><span class="id" title="definition">get_rolls</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>))) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.return_nil"><span class="id" title="axiom">Error_monad.return_nil</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">head_roll</span> ⇒ <a class="idref" href="Tezos.Roll_storage.html#traverse_rolls"><span class="id" title="definition">traverse_rolls</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="var">head_roll</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="count_rolls"><span class="id" title="definition">count_rolls</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> 0<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">head_roll</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">acc</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">roll</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="keyword">struct</span> <span class="id" title="var">acc</span>} : <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">next</span> ⇒ <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> (<a class="idref" href="Tezos.Environment.html#Pervasives.succ"><span class="id" title="axiom">Pervasives.succ</span></a> <a class="idref" href="Tezos.Roll_storage.html#acc"><span class="id" title="variable">acc</span></a>) <span class="id" title="var">next</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> 1 <span class="id" title="var">head_roll</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="get_change"><span class="id" title="definition">get_change</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">c</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Tez_repr.html#zero"><span class="id" title="definition">Tez_repr.zero</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="tactic">change</span> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <span class="id" title="tactic">change</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a name="Delegate"><span class="id" title="module">Delegate</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.fresh_roll"><span class="id" title="definition">fresh_roll</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.context"><span class="id" title="projection">Storage_sigs.Single_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.value"><span class="id" title="projection">Storage_sigs.Single_data_storage.value</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">roll</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.get"><span class="id" title="projection">Storage_sigs.Single_data_storage.get</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.set"><span class="id" title="projection">Storage_sigs.Single_data_storage.set</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Roll_repr.html#succ"><span class="id" title="definition">Roll_repr.succ</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.get_limbo_roll"><span class="id" title="definition">get_limbo_roll</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Limbo"><span class="id" title="axiom">Storage.Roll.Limbo</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.context"><span class="id" title="projection">Storage_sigs.Single_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.value"><span class="id" title="projection">Storage_sigs.Single_data_storage.value</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Limbo"><span class="id" title="axiom">Storage.Roll.Limbo</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Single_data_storage.get_option</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">roll</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">c</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.fresh_roll"><span class="id" title="definition">fresh_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Limbo"><span class="id" title="axiom">Storage.Roll.Limbo</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.init"><span class="id" title="projection">Storage_sigs.Single_data_storage.init</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">roll</span> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">roll</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.consume_roll_change"><span class="id" title="definition">consume_roll_change</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens_per_roll</span> := <a class="idref" href="Tezos.Constants_storage.html#tokens_per_roll"><span class="id" title="definition">Constants_storage.tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">new_change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.trace"><span class="id" title="axiom">Error_monad.trace</span></a> <span class="id" title="axiom">extensible_type_value</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_minusquestion"><span class="id" title="definition">Tez_repr.op_minusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a>)) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#new_change"><span class="id" title="variable">new_change</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.recover_roll_change"><span class="id" title="definition">recover_roll_change</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens_per_roll</span> := <a class="idref" href="Tezos.Constants_storage.html#tokens_per_roll"><span class="id" title="definition">Constants_storage.tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">new_change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_plusquestion"><span class="id" title="definition">Tez_repr.op_plusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#new_change"><span class="id" title="variable">new_change</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.pop_roll_from_delegate"><span class="id" title="definition">pop_roll_from_delegate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.value</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.recover_roll_change"><span class="id" title="definition">recover_roll_change</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">limbo_head</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Limbo"><span class="id" title="axiom">Storage.Roll.Limbo</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Single_data_storage.get_option</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.fail"><span class="id" title="axiom">Error_monad.fail</span></a> <span class="id" title="axiom">extensible_type_value</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">roll</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.delete"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.delete</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="var">roll</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">successor_roll</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="var">roll</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#successor_roll"><span class="id" title="variable">successor_roll</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="var">roll</span> <a class="idref" href="Tezos.Roll_storage.html#limbo_head"><span class="id" title="variable">limbo_head</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Limbo"><span class="id" title="axiom">Storage.Roll.Limbo</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.init_set"><span class="id" title="projection">Storage_sigs.Single_data_storage.init_set</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">roll</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">roll</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.create_roll_in_delegate"><span class="id" title="definition">create_roll_in_delegate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate_pk</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.value"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.value</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.consume_roll_change"><span class="id" title="definition">consume_roll_change</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">delegate_head</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">roll</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">c</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.get_limbo_roll"><span class="id" title="definition">get_limbo_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Owner"><span class="id" title="axiom">Storage.Roll.Owner</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_snapshotable_storage.init"><span class="id" title="projection">Storage_sigs.Indexed_data_snapshotable_storage.init</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate_pk"><span class="id" title="variable">delegate_pk</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">limbo_successor</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Limbo"><span class="id" title="axiom">Storage.Roll.Limbo</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.set_option"><span class="id" title="projection">Storage_sigs.Single_data_storage.set_option</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#limbo_successor"><span class="id" title="variable">limbo_successor</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Successor"><span class="id" title="axiom">Storage.Roll.Successor</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate_head"><span class="id" title="variable">delegate_head</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init_set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init_set</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#roll"><span class="id" title="variable">roll</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.ensure_inited"><span class="id" title="definition">ensure_inited</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.mem"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.mem</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Tez_repr.html#zero"><span class="id" title="definition">Tez_repr.zero</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.is_inactive"><span class="id" title="definition">is_inactive</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Inactive_delegate"><span class="id" title="axiom">Storage.Contract.Inactive_delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.context"><span class="id" title="projection">Storage_sigs.Data_set_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Environment.html#Signature.Public_key_hash"><span class="id" title="definition">Signature.Public_key_hash</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Environment.html#S.SPublic_key_hash.t"><span class="id" title="projection">S.SPublic_key_hash.t</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">inactive</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Inactive_delegate"><span class="id" title="axiom">Storage.Contract.Inactive_delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.mem"><span class="id" title="projection">Storage_sigs.Data_set_storage.mem</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> (<a class="idref" href="Tezos.Contract_repr.html#implicit_contract"><span class="id" title="definition">Contract_repr.implicit_contract</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a>) <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Roll_storage.html#inactive"><span class="id" title="variable">inactive</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#inactive"><span class="id" title="variable">inactive</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate_desactivation"><span class="id" title="axiom">Storage.Contract.Delegate_desactivation</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> (<a class="idref" href="Tezos.Contract_repr.html#implicit_contract"><span class="id" title="definition">Contract_repr.implicit_contract</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">last_active_cycle</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '<a class="idref" href="Tezos.Level_repr.html#t.Build"><span class="id" title="constructor">{|</span></a> <a class="idref" href="Tezos.Level_repr.html#t.Build"><span class="id" title="constructor">Level_repr.t.cycle</span></a> <a class="idref" href="Tezos.Level_repr.html#t.Build"><span class="id" title="constructor">:=</span></a> <a class="idref" href="Tezos.Level_repr.html#t.Build"><span class="id" title="constructor">current_cycle</span></a> <a class="idref" href="Tezos.Level_repr.html#t.Build"><span class="id" title="constructor">|}</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Raw_context.html#current_level"><span class="id" title="definition">Raw_context.current_level</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> (<a class="idref" href="Tezos.Cycle_repr.html#op_lt"><span class="id" title="definition">Cycle_repr.op_lt</span></a> <span class="id" title="var">last_active_cycle</span> <span class="id" title="var">current_cycle</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.return_false"><span class="id" title="axiom">Error_monad.return_false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.add_amount"><span class="id" title="definition">add_amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>) : <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.ensure_inited"><span class="id" title="definition">ensure_inited</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens_per_roll</span> := <a class="idref" href="Tezos.Constants_storage.html#tokens_per_roll"><span class="id" title="definition">Constants_storage.tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_plusquestion"><span class="id" title="definition">Tez_repr.op_plusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">delegate_pk</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate_pubkey"><span class="id" title="definition">delegate_pubkey</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span> (<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) (<span class="id" title="tactic">change</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">c</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Tez_repr.html#op_lt"><span class="id" title="definition">Tez_repr.op_lt</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_minusquestion"><span class="id" title="definition">Tez_repr.op_minusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.create_roll_in_delegate"><span class="id" title="definition">create_roll_in_delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate_pk"><span class="id" title="variable">delegate_pk</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">inactive</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.is_inactive"><span class="id" title="definition">is_inactive</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Roll_storage.html#inactive"><span class="id" title="variable">inactive</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">rolls</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#rolls"><span class="id" title="variable">rolls</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Active_delegates_with_rolls"><span class="id" title="axiom">Storage.Active_delegates_with_rolls</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.add"><span class="id" title="projection">Storage_sigs.Data_set_storage.add</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.remove_amount"><span class="id" title="definition">remove_amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>) : <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens_per_roll</span> := <a class="idref" href="Tezos.Constants_storage.html#tokens_per_roll"><span class="id" title="definition">Constants_storage.tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span> (<span class="id" title="var">c</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) (<span class="id" title="tactic">change</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">c</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> (<a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Tez_repr.html#op_lteq"><span class="id" title="definition">Tez_repr.op_lteq</span></a> <a class="idref" href="Tezos.Roll_storage.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">c</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.pop_roll_from_delegate"><span class="id" title="definition">pop_roll_from_delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_plusquestion"><span class="id" title="definition">Tez_repr.op_plusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">inactive</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.is_inactive"><span class="id" title="definition">is_inactive</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">c</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="tactic">change</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Roll_storage.html#inactive"><span class="id" title="variable">inactive</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">c</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="tactic">change</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">rolls</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#rolls"><span class="id" title="variable">rolls</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">c</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Active_delegates_with_rolls"><span class="id" title="axiom">Storage.Active_delegates_with_rolls</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.del"><span class="id" title="projection">Storage_sigs.Data_set_storage.del</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_minusquestion"><span class="id" title="definition">Tez_repr.op_minusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#amount"><span class="id" title="variable">amount</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set</span></a>) <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.set_inactive"><span class="id" title="definition">set_inactive</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.ensure_inited"><span class="id" title="definition">ensure_inited</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens_per_roll</span> := <a class="idref" href="Tezos.Constants_storage.html#tokens_per_roll"><span class="id" title="definition">Constants_storage.tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Inactive_delegate"><span class="id" title="axiom">Storage.Contract.Inactive_delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.add"><span class="id" title="projection">Storage_sigs.Data_set_storage.add</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Contract_repr.html#implicit_contract"><span class="id" title="definition">Contract_repr.implicit_contract</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a>) <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Active_delegates_with_rolls"><span class="id" title="axiom">Storage.Active_delegates_with_rolls</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.del"><span class="id" title="projection">Storage_sigs.Data_set_storage.del</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">change</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">ctxt</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">×</span></a> <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_roll</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">ctxt</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.pop_roll_from_delegate"><span class="id" title="definition">pop_roll_from_delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_plusquestion"><span class="id" title="definition">Tez_repr.op_plusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">=?</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">ctxt</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="tactic">change</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Environment.html#0bda090fdf5de4b8721bd60dca0fe8ed"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.set</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Delegate.set_active"><span class="id" title="definition">set_active</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Inactive_delegate"><span class="id" title="axiom">Storage.Contract.Inactive_delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.context"><span class="id" title="projection">Storage_sigs.Data_set_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Environment.html#Signature.Public_key_hash"><span class="id" title="definition">Signature.Public_key_hash</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Environment.html#S.SPublic_key_hash.t"><span class="id" title="projection">S.SPublic_key_hash.t</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">inactive</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.is_inactive"><span class="id" title="definition">is_inactive</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">current_cycle</span> := (<a class="idref" href="Tezos.Raw_context.html#current_level"><span class="id" title="definition">Raw_context.current_level</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>).(<a class="idref" href="Tezos.Level_repr.html#t.cycle"><span class="id" title="projection">Level_repr.t.cycle</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">preserved_cycles</span> := <a class="idref" href="Tezos.Constants_storage.html#preserved_cycles"><span class="id" title="definition">Constants_storage.preserved_cycles</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">current_expiration</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate_desactivation"><span class="id" title="axiom">Storage.Contract.Delegate_desactivation</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Contract_repr.html#implicit_contract"><span class="id" title="definition">Contract_repr.implicit_contract</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">expiration</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#current_expiration"><span class="id" title="variable">current_expiration</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Cycle_repr.html#add"><span class="id" title="definition">Cycle_repr.add</span></a> <a class="idref" href="Tezos.Roll_storage.html#current_cycle"><span class="id" title="variable">current_cycle</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> 1 (<a class="idref" href="Tezos.Environment.html#Pervasives.op_star"><span class="id" title="axiom">Pervasives.op_star</span></a> 2 <a class="idref" href="Tezos.Roll_storage.html#preserved_cycles"><span class="id" title="variable">preserved_cycles</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">current_expiration</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">delay</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Roll_storage.html#inactive"><span class="id" title="variable">inactive</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> 1 (<a class="idref" href="Tezos.Environment.html#Pervasives.op_star"><span class="id" title="axiom">Pervasives.op_star</span></a> 2 <a class="idref" href="Tezos.Roll_storage.html#preserved_cycles"><span class="id" title="variable">preserved_cycles</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> 1 <a class="idref" href="Tezos.Roll_storage.html#preserved_cycles"><span class="id" title="variable">preserved_cycles</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">updated</span> := <a class="idref" href="Tezos.Cycle_repr.html#add"><span class="id" title="definition">Cycle_repr.add</span></a> <a class="idref" href="Tezos.Roll_storage.html#current_cycle"><span class="id" title="variable">current_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#delay"><span class="id" title="variable">delay</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Cycle_repr.html#max"><span class="id" title="definition">Cycle_repr.max</span></a> <a class="idref" href="Tezos.Roll_storage.html#current_expiration"><span class="id" title="variable">current_expiration</span></a> <a class="idref" href="Tezos.Roll_storage.html#updated"><span class="id" title="variable">updated</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate_desactivation"><span class="id" title="axiom">Storage.Contract.Delegate_desactivation</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init_set"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init_set</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Contract_repr.html#implicit_contract"><span class="id" title="definition">Contract_repr.implicit_contract</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a>) <a class="idref" href="Tezos.Roll_storage.html#expiration"><span class="id" title="variable">expiration</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Environment.html#Pervasives.not"><span class="id" title="axiom">Pervasives.not</span></a> <a class="idref" href="Tezos.Roll_storage.html#inactive"><span class="id" title="variable">inactive</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.ensure_inited"><span class="id" title="definition">ensure_inited</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens_per_roll</span> := <a class="idref" href="Tezos.Constants_storage.html#tokens_per_roll"><span class="id" title="definition">Constants_storage.tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_change"><span class="id" title="axiom">Storage.Roll.Delegate_change</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Inactive_delegate"><span class="id" title="axiom">Storage.Contract.Inactive_delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.del"><span class="id" title="projection">Storage_sigs.Data_set_storage.del</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Contract_repr.html#implicit_contract"><span class="id" title="definition">Contract_repr.implicit_contract</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a>) <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">delegate_pk</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate_pubkey"><span class="id" title="definition">delegate_pubkey</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <span class="id" title="var">loop</span> (<span class="id" title="var">ctxt</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) (<span class="id" title="tactic">change</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="keyword">struct</span> <span class="id" title="var">ctxt</span>} : <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Tez_repr.html#op_lt"><span class="id" title="definition">Tez_repr.op_lt</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="tactic">change</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_minusquestion"><span class="id" title="definition">Tez_repr.op_minusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Roll_storage.html#tokens_per_roll"><span class="id" title="variable">tokens_per_roll</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#Delegate.create_roll_in_delegate"><span class="id" title="definition">create_roll_in_delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate_pk"><span class="id" title="variable">delegate_pk</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#loop"><span class="id" title="variable">loop</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#change"><span class="id" title="variable">change</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">rolls</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Roll.Delegate_roll_list"><span class="id" title="axiom">Storage.Roll.Delegate_roll_list</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.get_option"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.get_option</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#rolls"><span class="id" title="variable">rolls</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Active_delegates_with_rolls"><span class="id" title="axiom">Storage.Active_delegates_with_rolls</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.add"><span class="id" title="projection">Storage_sigs.Data_set_storage.add</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Tezos.Roll_storage.html#Delegate"><span class="id" title="module">Delegate</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a name="Contract"><span class="id" title="module">Contract</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Contract.add_amount"><span class="id" title="definition">add_amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">contract</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#get_contract_delegate"><span class="id" title="definition">get_contract_delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#contract"><span class="id" title="variable">contract</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">delegate</span> ⇒ <a class="idref" href="Tezos.Roll_storage.html#Delegate.add_amount"><span class="id" title="definition">Delegate.add_amount</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="var">delegate</span> <a class="idref" href="Tezos.Roll_storage.html#amount"><span class="id" title="variable">amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Contract.remove_amount"><span class="id" title="definition">remove_amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">contract</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.key"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.key</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Storage.Contract.Delegate"><span class="id" title="axiom">Storage.Contract.Delegate</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.context"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.context</span></a>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">function_parameter</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#get_contract_delegate"><span class="id" title="definition">get_contract_delegate</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <a class="idref" href="Tezos.Roll_storage.html#contract"><span class="id" title="variable">contract</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Roll_storage.html#function_parameter"><span class="id" title="variable">function_parameter</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">delegate</span> ⇒ <a class="idref" href="Tezos.Roll_storage.html#Delegate.remove_amount"><span class="id" title="definition">Delegate.remove_amount</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a> <span class="id" title="var">delegate</span> <a class="idref" href="Tezos.Roll_storage.html#amount"><span class="id" title="variable">amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Tezos.Roll_storage.html#Contract"><span class="id" title="module">Contract</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="init"><span class="id" title="definition">init</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> : <span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.context"><span class="id" title="projection">Storage_sigs.Single_data_storage.context</span></a>))<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Next"><span class="id" title="axiom">Storage.Roll.Next</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Single_data_storage.init"><span class="id" title="projection">Storage_sigs.Single_data_storage.init</span></a>) <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_repr.html#first"><span class="id" title="definition">Roll_repr.first</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="init_first_cycles"><span class="id" title="definition">init_first_cycles</span></a> (<span class="id" title="var">ctxt</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">preserved</span> := <a class="idref" href="Tezos.Constants_storage.html#preserved_cycles"><span class="id" title="definition">Constants_storage.preserved_cycles</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#List.fold_left"><span class="id" title="axiom">List.fold_left</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">ctxt</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">cycle</span> := <a class="idref" href="Tezos.Cycle_repr.html#of_int32_exn"><span class="id" title="definition">Cycle_repr.of_int32_exn</span></a> (<a class="idref" href="Tezos.Environment.html#Int32.of_int"><span class="id" title="axiom">Int32.of_int</span></a> <a class="idref" href="Tezos.Roll_storage.html#c"><span class="id" title="variable">c</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> 0 <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#snapshot_rolls_for_cycle"><span class="id" title="definition">snapshot_rolls_for_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#freeze_rolls_for_cycle"><span class="id" title="definition">freeze_rolls_for_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a>) (<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Misc.html#op_minusminusgt"><span class="id" title="definition">Misc.op_minusminusgt</span></a> 0 <a class="idref" href="Tezos.Roll_storage.html#preserved"><span class="id" title="variable">preserved</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">cycle</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Cycle_repr.html#of_int32_exn"><span class="id" title="definition">Cycle_repr.of_int32_exn</span></a> (<a class="idref" href="Tezos.Environment.html#Int32.of_int"><span class="id" title="axiom">Int32.of_int</span></a> (<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> <a class="idref" href="Tezos.Roll_storage.html#preserved"><span class="id" title="variable">preserved</span></a> 1)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> 0 <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#snapshot_rolls_for_cycle"><span class="id" title="definition">snapshot_rolls_for_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">cycle</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Cycle_repr.html#of_int32_exn"><span class="id" title="definition">Cycle_repr.of_int32_exn</span></a> (<a class="idref" href="Tezos.Environment.html#Int32.of_int"><span class="id" title="axiom">Int32.of_int</span></a> (<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> <a class="idref" href="Tezos.Roll_storage.html#preserved"><span class="id" title="variable">preserved</span></a> 2)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a> 0 <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="snapshot_rolls"><span class="id" title="definition">snapshot_rolls</span></a> (<span class="id" title="var">ctxt</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">current_level</span> := <a class="idref" href="Tezos.Raw_context.html#current_level"><span class="id" title="definition">Raw_context.current_level</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">preserved</span> := <a class="idref" href="Tezos.Constants_storage.html#preserved_cycles"><span class="id" title="definition">Constants_storage.preserved_cycles</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">cycle</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Cycle_repr.html#add"><span class="id" title="definition">Cycle_repr.add</span></a> <a class="idref" href="Tezos.Roll_storage.html#current_level"><span class="id" title="variable">current_level</span></a>.(<a class="idref" href="Tezos.Level_repr.html#t.cycle"><span class="id" title="projection">Level_repr.t.cycle</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> <a class="idref" href="Tezos.Roll_storage.html#preserved"><span class="id" title="variable">preserved</span></a> 2) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#snapshot_rolls_for_cycle"><span class="id" title="definition">snapshot_rolls_for_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#cycle"><span class="id" title="variable">cycle</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="cycle_end"><span class="id" title="definition">cycle_end</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) (<span class="id" title="var">last_cycle</span> : <a class="idref" href="Tezos.Cycle_repr.html#cycle"><span class="id" title="definition">Cycle_repr.cycle</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#t"><span class="id" title="definition">Raw_context.t</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">preserved</span> := <a class="idref" href="Tezos.Constants_storage.html#preserved_cycles"><span class="id" title="definition">Constants_storage.preserved_cycles</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Tezos.Cycle_repr.html#sub"><span class="id" title="definition">Cycle_repr.sub</span></a> <a class="idref" href="Tezos.Roll_storage.html#last_cycle"><span class="id" title="variable">last_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#preserved"><span class="id" title="variable">preserved</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> ⇒ <a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">cleared_cycle</span> ⇒ <a class="idref" href="Tezos.Roll_storage.html#clear_cycle"><span class="id" title="definition">clear_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="var">cleared_cycle</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">frozen_roll_cycle</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Cycle_repr.html#add"><span class="id" title="definition">Cycle_repr.add</span></a> <a class="idref" href="Tezos.Roll_storage.html#last_cycle"><span class="id" title="variable">last_cycle</span></a> (<a class="idref" href="Tezos.Environment.html#Pervasives.op_plus"><span class="id" title="axiom">Pervasives.op_plus</span></a> <a class="idref" href="Tezos.Roll_storage.html#preserved"><span class="id" title="variable">preserved</span></a> 1) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#freeze_rolls_for_cycle"><span class="id" title="definition">freeze_rolls_for_cycle</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#frozen_roll_cycle"><span class="id" title="variable">frozen_roll_cycle</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Snapshot_for_cycle"><span class="id" title="axiom">Storage.Roll.Snapshot_for_cycle</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Indexed_data_storage.init"><span class="id" title="projection">Storage_sigs.Indexed_data_storage.init</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> (<a class="idref" href="Tezos.Cycle_repr.html#succ"><span class="id" title="definition">Cycle_repr.succ</span></a> (<a class="idref" href="Tezos.Cycle_repr.html#succ"><span class="id" title="definition">Cycle_repr.succ</span></a> <a class="idref" href="Tezos.Roll_storage.html#frozen_roll_cycle"><span class="id" title="variable">frozen_roll_cycle</span></a>)) 0 <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Error_monad.__return"><span class="id" title="axiom">Error_monad.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="update_tokens_per_roll"><span class="id" title="definition">update_tokens_per_roll</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="var">ctxt</span> : <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) (<span class="id" title="var">new_tokens_per_roll</span> : <a class="idref" href="Tezos.Tez_repr.html#t"><span class="id" title="definition">Tez_repr.t</span></a>)<br/>
&nbsp;&nbsp;: <a class="idref" href="Tezos.Environment.html#Lwt.t"><span class="id" title="axiom">Lwt.t</span></a> (<a class="idref" href="Tezos.Environment.html#Error_monad.tzresult"><span class="id" title="definition">Error_monad.tzresult</span></a> <a class="idref" href="Tezos.Raw_context.html#context"><span class="id" title="definition">Raw_context.context</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">constants</span> := <a class="idref" href="Tezos.Raw_context.html#constants"><span class="id" title="definition">Raw_context.constants</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">old_tokens_per_roll</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#constants"><span class="id" title="variable">constants</span></a>.(<a class="idref" href="Tezos.Constants_repr.html#parametric.tokens_per_roll"><span class="id" title="projection">Constants_repr.parametric.tokens_per_roll</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">=</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Raw_context.html#patch_constants"><span class="id" title="definition">Raw_context.patch_constants</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">constants</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Constants_repr.html#parametric.with_tokens_per_roll"><span class="id" title="definition">Constants_repr.parametric.with_tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#new_tokens_per_roll"><span class="id" title="variable">new_tokens_per_roll</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#constants"><span class="id" title="variable">constants</span></a>) <a class="idref" href="Tezos.Environment.html#792d2b92bd0d4bf4ce356163f834167c"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">decrease</span> := <a class="idref" href="Tezos.Tez_repr.html#op_lt"><span class="id" title="definition">Tez_repr.op_lt</span></a> <a class="idref" href="Tezos.Roll_storage.html#new_tokens_per_roll"><span class="id" title="variable">new_tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#old_tokens_per_roll"><span class="id" title="variable">old_tokens_per_roll</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">abs_diff</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Roll_storage.html#decrease"><span class="id" title="variable">decrease</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Tez_repr.html#op_minusquestion"><span class="id" title="definition">Tez_repr.op_minusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#old_tokens_per_roll"><span class="id" title="variable">old_tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#new_tokens_per_roll"><span class="id" title="variable">new_tokens_per_roll</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Tez_repr.html#op_minusquestion"><span class="id" title="definition">Tez_repr.op_minusquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#new_tokens_per_roll"><span class="id" title="variable">new_tokens_per_roll</span></a> <a class="idref" href="Tezos.Roll_storage.html#old_tokens_per_roll"><span class="id" title="variable">old_tokens_per_roll</span></a>) <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;<span class="id" title="notation">(|</span><a class="idref" href="Tezos.Roll_storage.html#Delegates"><span class="id" title="axiom">Storage.Delegates</span></a><span class="id" title="notation">|)</span>.(<a class="idref" href="Tezos.Storage_sigs.html#Data_set_storage.fold"><span class="id" title="projection">Storage_sigs.Data_set_storage.fold</span></a>) <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Tezos.Environment.html#Pervasives.Ok"><span class="id" title="constructor">Pervasives.Ok</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">pkh</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">ctxt</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">ctxt</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">rolls</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a> <a class="idref" href="Tezos.Roll_storage.html#count_rolls"><span class="id" title="definition">count_rolls</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#pkh"><span class="id" title="variable">pkh</span></a> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">let</span></a><a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">=?</span></a> <span class="id" title="var">amount</span> <a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#Lwt.__return"><span class="id" title="axiom">Lwt.__return</span></a> (<a class="idref" href="Tezos.Tez_repr.html#op_starquestion"><span class="id" title="definition">Tez_repr.op_starquestion</span></a> <a class="idref" href="Tezos.Roll_storage.html#abs_diff"><span class="id" title="variable">abs_diff</span></a> (<a class="idref" href="Tezos.Environment.html#Int64.of_int"><span class="id" title="axiom">Int64.of_int</span></a> <a class="idref" href="Tezos.Roll_storage.html#rolls"><span class="id" title="variable">rolls</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Environment.html#fe7ed8135c3e89d56eff82d8ee27a32f"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="Tezos.Roll_storage.html#decrease"><span class="id" title="variable">decrease</span></a> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#add_amount"><span class="id" title="definition">Delegate.add_amount</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#pkh"><span class="id" title="variable">pkh</span></a> <a class="idref" href="Tezos.Roll_storage.html#amount"><span class="id" title="variable">amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Tezos.Roll_storage.html#remove_amount"><span class="id" title="definition">Delegate.remove_amount</span></a> <a class="idref" href="Tezos.Roll_storage.html#ctxt"><span class="id" title="variable">ctxt</span></a> <a class="idref" href="Tezos.Roll_storage.html#pkh"><span class="id" title="variable">pkh</span></a> <a class="idref" href="Tezos.Roll_storage.html#amount"><span class="id" title="variable">amount</span></a>).<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>